add_namespace = nma_spain

# Giving Nationalist Spain wargoal on Portugal right after Danzig or War
country_event = {
  id = nma_spain.1
  title = nma_spain.1.t
  desc = nma_spain.1.d

  picture = GFX_report_event_molotov_ribentrop_handshake

  fire_only_once = yes
  is_triggered_only = yes

  option = {
    name = nma_spain.1.a

    if = {
      limit = {
        original_tag = SPR
      }
      create_wargoal = {
        type = annex_everything
        target = POR
      }

      POR = {
        add_ideas = non_capitulatable
        load_oob = "POR_army"
      }
    }
  }
}

# Portugal folds
country_event = {
  id = nma_spain.2
  title = nma_spain.2.t
  desc = nma_spain.2.d

  picture = GFX_report_event_generic_sign_treaty3

  fire_only_once = yes

  mean_time_to_happen = { days = 1 }

  trigger = {
    original_tag = POR
    has_war_with = SPR
    OR = {
      surrender_progress > 0.5
      112 = {
        NOT = {
          is_controlled_by = POR
        }
      }
    }
  }

  option = {
    name = nma_spain.2.a

    log = "[THIS.GetNameDef] folds to SPR"

    delete_unit_template_and_units = { division_template = "Portugal Livre" }

    random_other_country = {
      limit = {
        original_tag = SPR
        has_government = fascism
      }

      white_peace = POR

      transfer_state = 112
      transfer_state = 179
      transfer_state = 180
      transfer_state = 181
    }
  }
}
